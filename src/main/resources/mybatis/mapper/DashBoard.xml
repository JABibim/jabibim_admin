<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jabibim.admin.mybatis.mapper.DashboardMapper">

    <select id="getWaitRefundCount" resultType="int">
        SELECT COUNT(*)
        FROM PAYMENT P
        INNER JOIN STUDENT S ON P.STUDENT_ID = S.STUDENT_ID
        INNER JOIN COURSE C ON P.STUDENT_ID = C.COURSE_ID
        WHERE P.PAYMENT_STATUS = 2
        <if test="!isAdmin">
            AND S.ACADEMY_ID = #{academyId}
        </if>
    </select>

    <!-- 강의 개수 및 활성화 상태 조회 -->
    <select id="getCourseStatus" parameterType="map" resultType="map">
        SELECT
        COUNT(*) AS totalCourses,
        SUM(CASE WHEN C.COURSE_ACTIVATION = 1 THEN 1 ELSE 0 END) AS activeCount,
        SUM(CASE WHEN C.COURSE_ACTIVATION = 0 THEN 1 ELSE 0 END) AS inactiveCount
        FROM COURSE C
        JOIN TEACHER T ON C.TEACHER_ID = T.TEACHER_ID
        WHERE C.DELETED_AT IS NULL AND T.DELETED_AT IS NULL
        <if test="!isAdmin">
            AND T.ACADEMY_ID = #{academyId}
        </if>
    </select>

</mapper>



